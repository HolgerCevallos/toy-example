# Toy Example -- Nonasymptotic Distributional Shift

## Overview

This document reproduces a toy simulation illustrating the Nonasymptotic
Distributional Shift conformal method combined with a robust PCA
(DsubLTS) procedure.

------------------------------------------------------------------------

## Load Required Libraries

``` r
library(Rcpp)
library(RcppArmadillo)
library(robustbase)
library(mgcv)
library(EasyMMD)
```

## How to Run

1. Clone the repository:

git clone https://github.com/HolgerCevallos/toy-example.git

2. Open R or RStudio and set the working directory to the project folder.

3. Run the main script:

source("toy.example.R")
=======
------------------------------------------------------------------------

## Compile C++ Sources

``` r
Rcpp::sourceCpp('src/MyPcs.cpp')
Rcpp::sourceCpp('src/MyPcs2.cpp')
Rcpp::sourceCpp('src/MyclassicalPcs.v2.cpp')
```

------------------------------------------------------------------------

## Load R Functions

``` r
source("R/DsubLTS.R")
source("R/NonasymptoticDistributionalShift.final.R")
```

------------------------------------------------------------------------

## Data Generation (Summary)

-   5 simulated patients\
-   30 curves per patient\
-   21 time points\
-   Functional basis expansion with sinusoidal components\
-   Gaussian noise with Ïƒ = 1

------------------------------------------------------------------------

## Apply Distributional Shift Method

``` r
fit.pooled.method <- DistributionalShift.fun(
  x = Yij.todos,
  mesh = tm,
  dimension.Bspline = 20,
  q = 2,
  indexTargetSubject = 1,
  alpha = 0.5
)
```

------------------------------------------------------------------------

## Key Results

### Quantile

``` r
fit.pooled.method$quantile

[1] 0.7450538
```
### Prediction Region Indices

``` r
fit.pooled.method$predictionRegionIndices

[1]  3  4  6  7  9 10 11 12 13 14 17 18 19 22 24 25 27
```

### Prediction Region Curves

``` r
fit.pooled.method$predictionRegionCurves

       [,1]        [,2]       [,3]        [,4]        [,5]       [,6]       [,7]       [,8]       [,9]      [,10]
 [1,]  1.0431530  2.92681995 -2.0480004  0.57764602 -2.05610240  0.9402543 -0.6274168 -0.4998684  0.1705439 -1.3309393
 [2,] -0.5043934 -0.66473741  2.2776497 -1.46477122  0.74498893 -0.7089303 -0.1247201  0.2195308  0.9220983 -0.4804442
 [3,] -2.1307619 -4.93675059  7.5942363  2.27297871  5.41409298 -1.9076930 -0.6060359 -1.9044408 -0.8423025 -0.2030379
 [4,]  0.9730330  1.23154425 -0.9262327 -1.76618087 -2.09716357  1.7670645  0.2694728 -1.3940065  0.1179784  0.2665146
 [5,] -1.0565654 -0.35314489  0.5443737  0.63990523  1.21127349 -1.2653785  0.3748302 -1.0255051  0.1319251 -0.8019406
 [6,]  0.6333278  2.05091959 -2.7673604 -0.08351168 -2.33178873  1.7986204 -0.3300425 -1.1223234  0.6967439 -0.7328405
 [7,]  1.0401857  0.52424002 -0.7887945 -0.66097091 -0.74638866 -0.3292745 -0.0612305  0.4327479  0.7204645  1.2369084
 [8,]  0.4965923  1.39431571 -2.2293426  0.21193111  0.62639943  0.6549587  0.2945480 -1.6167346  0.3810880 -2.2779429
 [9,] -1.0177635 -0.40090609  0.1644893  0.91776502  2.66291640 -2.7096171  0.3132750  2.1223698 -1.4127056 -0.8687584
[10,]  0.6751311 -0.01573545 -1.0991831 -0.53718651 -0.11744272 -1.7993936  0.5141915  1.3541483  0.3973499  2.1718974
[11,] -1.3089618 -2.03317786  2.4048836  1.82121550  0.94995078 -1.0162510  1.6797274  0.7844474  0.3521888 -0.4488545
[12,] -2.1018900 -3.87371582  4.3691439  2.47615290  3.84373049 -2.4232440  0.5694433 -0.7625929 -0.8448232  0.6136308
[13,] -1.7677357 -6.23346663  5.8046179  0.68966873  4.18262389 -3.2581964  0.7313156  0.6458913  0.3969556 -0.2652796
[14,]  1.5573615  4.27489593 -0.2552738  0.61922011 -0.07026226  2.3901535 -0.6731929 -1.4686913 -0.6136997 -0.1734925
[15,]  1.8703453  4.08207893 -3.9060491 -0.01191231 -4.38628244  1.9293939  0.6197987  0.2371635  0.6862576 -1.0762753
[16,] -1.2033224 -2.55713383  3.0425479  0.87456047  2.13462772 -0.4538268  1.1752907  1.3553602  0.5762729 -1.3349562
[17,] -0.2248864 -1.34197619 -0.4610374 -0.98060755  0.12818609  1.4057347 -1.1374476  0.7380825 -0.4545678  0.1788595
            [,11]       [,12]       [,13]      [,14]       [,15]       [,16]      [,17]       [,18]       [,19]
 [1,] -1.03544481  0.09548121 -0.39937109  2.0944910 -0.42363806 -0.15388586 -0.9511579 -1.28738767 -0.19760784
 [2,]  0.30309260  0.05100015 -0.65769947 -0.4492274  0.59630173 -0.21256429  0.7868839 -0.71732103  1.80057559
 [3,] -0.66762784 -0.78282877 -1.01807678  0.7966791  0.26255750  1.67812467  0.8890217 -0.03564797 -2.49393286
 [4,]  0.63390310 -1.12500097 -0.04531882 -0.9814908 -0.47026500  0.11175700  0.7188897  0.53386477 -1.59505717
 [5,] -0.94999654 -0.44569978 -1.97945760 -0.4845401  2.36576816 -0.92781851 -0.4217904  0.19001783 -0.22231229
 [6,]  0.26567826  1.90221680  1.84151822  0.2174873  0.86274081 -0.81400294  0.4697564  0.68775463  0.73999144
 [7,]  0.08935172 -1.15364472  0.27194679  1.1070186 -1.32574920  0.25141541 -0.9435764 -0.65266628  1.12841063
 [8,]  0.73901127  1.13744987  0.01581133  1.1314069  1.51379462  1.49862984  0.4417694 -2.08975592  0.09068133
 [9,]  0.38320462 -0.07864843  0.42691620  0.5693766 -0.08985381  0.08502335 -1.2166348 -1.04109515  1.34141598
[10,]  0.26307661  0.29240029  2.46198215 -0.4838918  1.50985626  1.54247786 -1.2504492 -1.27774085  0.39500757
[11,] -1.26952763  0.41230791  1.10701447 -1.1523520 -2.32952339 -0.27604445  0.8334881 -1.50087329 -0.88739725
[12,] -0.97836610 -0.02323199  1.01033961  0.6648881 -0.98027015  1.02984628  1.4238639 -0.11689994 -0.71299170
[13,] -0.37371783 -0.62625739  0.07991185  0.6830636  1.24134528  1.78011926  1.3177676 -0.45575364 -0.08298067
[14,] -1.66710634  0.32608952 -0.73534125  1.2403770 -1.27412184  0.89032919 -0.2962169  0.22561052  0.67733998
[15,] -0.11826966  0.79044790 -0.97294899 -1.0984504  0.67472889  0.05077342 -1.7233322 -0.43232490  0.29508628
[16,]  0.19528979 -0.98300164 -1.37136836 -0.8981009  1.06900477 -0.59523172  0.7639567  0.97744051  0.52437694
[17,]  1.00157269 -0.52754089  0.62662414 -0.2983624  0.49399769  0.03828924  0.8274457  1.78893026 -0.73048081
              [,20]
 [1,]  0.2191922156
 [2,]  0.1957117039
 [3,]  1.1514634311
 [4,] -1.3492016881
 [5,]  2.2519545528
 [6,] -0.7519475326
 [7,] -0.6051692324
 [8,] -1.1707554857
 [9,]  0.2140183966
[10,] -1.1843128349
[11,] -1.2093724478
[12,] -0.9157990079
[13,] -0.2486838021
[14,]  1.2159304191
[15,]  0.4273092611
[16,]  1.0540688974
[17,] -0.0003760754
```

### Coverage

``` r
fit.pooled.method$coverage

[1] 0.5666667
```

------------------------------------------------------------------------

## Reproducibility

To reproduce the full analysis locally:

``` r
source("toy.example.R")
```

This script compiles the C++ code, generates the synthetic data, and
applies the conformal prediction method automatically.
>>>>>>> 75b0189 (Add reproducible analysis results)
